<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario con Tabs</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Navigation bar -->
    <div class="navbar">
        <a href="index.html">Home</a>
        <a href="preferences.html">Preferences</a>
        <a href="status.html">Status</a>
        <a href="low_power.html" class="active">Thresholds</a>        
        <div id="otaLink">
            <a href="ota.html">OTA</a>
        </div>
    </div>

    <div class="content">
        <h1>CO2 Gadget Low Power Configuration</h1>
        <form id="preferencesForm">           

            <!-- Thresholds Options Group -->
            <fieldset>
                <legend>Threshold Options</legend>

                <div class="tab-container">
                    <div class="tab" onclick="openTab(event, 'Display')">
                        <input type="checkbox" id="chkDisplay" onchange="toggleTab('Display')">
                        <label for="chkDisplay">Display</label>
                    </div>
                    <div class="tab" onclick="openTab(event, 'Bluetooth')">
                        <input type="checkbox" id="chkBluetooth" onchange="toggleTab('Bluetooth')">
                        <label for="chkBluetooth">Bluetooth</label>
                    </div>
                    <div class="tab" onclick="openTab(event, 'MQTT')">
                        <input type="checkbox" id="chkMQTT" onchange="toggleTab('MQTT')">
                        <label for="chkMQTT">MQTT</label>
                    </div>
                    <div class="tab" onclick="openTab(event, 'ESPNOW')">
                        <input type="checkbox" id="chkESPNOW" onchange="toggleTab('ESPNOW')">
                        <label for="chkESPNOW">ESPNOW</label>
                    </div>

                    <div id="Display" class="tab-content">
                        <p>These are the thresholds for the display when in low power mode.</p>

                        <fieldset>
                            <legend>General Settings</legend>
                            <div>
                                <label for="keepAliveTimeDisplay">Keep Alive Time
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">Maximum time in seconds to update values if the threshold is not met. CO2 Gadget will update the display regardless of the threshold if this time has passed since the last update.</span>
                                </label>
                                <input type="number" id="keepAliveTimeDisplay" name="keepAliveTimeDisplay" value="0">
                            </div>
                            <div>
                                <label for="thrOnlyInLowPDisplay">Apply threshold only in low power mode</label>
                                <!-- <input type="radio" id="thrOnlyInLowPDisplay" name="thrOnlyInLowPDisplay" value="true">
                                <span class="tooltip-icon">ℹ️</span> -->
                                <span class="tooltip-text">Apply the threshold only when the device is in low power
                                    mode.</span>
                                <input type="radio" id="thrOnlyInLowPDisplay" name="thrOnlyInLowPDisplay" value="false">
                                <span class="tooltip-icon">ℹ️</span>
                                <span class="tooltip-text">Apply the threshold when the device is not in low power
                                    mode.</span>
                        </fieldset>


                        <fieldset>
                            <legend>Thresholds Options for Display</legend>
                            <fieldset>
                                <div>
                                    <label for="co2ThresholdAbsDisplay">CO2 Threshold Absolute (ppm value):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The absolute value difference of CO2 in ppm that will
                                        trigger
                                        the
                                        threshold. The display will not be updated until the threshold is met.</span>
                                    <input type="number" id="co2ThresholdAbsDisplay" name="co2ThresholdAbsDisplay" value="">
                                </div>
                                <div>
                                    <label for="co2ThresholdPctDisplay">CO2 Threshold Percentage (ppm percentage):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The percentage difference of CO2 in ppm that will trigger
                                        the
                                        threshold. The display will not be updated until the threshold is met.</span>
                                    <input type="number" id="co2ThresholdPctDisplay" name="co2ThresholdPctDisplay" value="">
                                </div>
                                <div>
                                    <label for="co2ThresholdAndOr">Combine with:</label>
                                    <input type="radio" id="co2ThresholdAnd" name="co2ThresholdAndOr" value="and">
                                    <label for="co2ThresholdAnd">AND</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">Both conditions must be met to trigger the
                                        threshold.</span>
                                    <input type="radio" id="co2ThresholdOr" name="co2ThresholdAndOr" value="or">
                                    <label for="co2ThresholdOr">OR</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">At least one condition must be met to trigger the
                                        threshold.</span>
                                </div>

                            </fieldset>

                            <fieldset>
                                <div>
                                    <label for="tempThresholdAbsDisplay">Temp Threshold Absolute (°C value):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The absolute value difference of temperature in °C that
                                        will
                                        trigger the threshold. The display will not be updated until the threshold is
                                        met.</span>
                                    <input type="number" step="any" id="tempThresholdAbsDisplay" name="tempThresholdAbsDisplay" value="">
                                </div>
                                <div>
                                    <label for="tempThresholdPctDisplay">Temp Threshold Percentage (°C percentage):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The percentage difference of temperature in °C that will
                                        trigger
                                        the threshold. The display will not be updated until the threshold is
                                        met.</span>
                                    <input type="number" id="tempThresholdPctDisplay" name="tempThresholdPctDisplay" value="">
                                </div>
                                <div>
                                    <label for="tempThresholdAndOr">Combine with:</label>
                                    <input type="radio" id="tempThresholdAnd" name="tempThresholdAndOr" value="and">
                                    <label for="tempThresholdAnd">AND</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">Both conditions must be met to trigger the
                                        threshold.</span>
                                    <input type="radio" id="tempThresholdOr" name="tempThresholdAndOr" value="or">
                                    <label for="tempThresholdOr">OR</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">At least one condition must be met to trigger the
                                        threshold.</span>
                                </div>
                            </fieldset>

                            <fieldset>
                                <div>
                                    <label for="humThresholdAbsDisplay">Hum Threshold Absolute (%rH value):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The absolute value difference of humidity in %rH that
                                        will
                                        trigger
                                        the threshold. The display will not be updated until the threshold is
                                        met.</span>
                                    <input type="number" id="humThresholdAbsDisplay" name="humThresholdAbsDisplay" value="">
                                </div>
                                <div>
                                    <label for="humThresholdPctDisplay">Hum Threshold Percentage (%rH percentage):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The percentage difference of humidity in %rH that will
                                        trigger
                                        the threshold. The display will not be updated until the threshold is
                                        met.</span>
                                    <input type="number" id="humThresholdPctDisplay" name="humThresholdPctDisplay" value="">
                                </div>
                                <div>
                                    <label for="humThresholdAndOr">Combine with:</label>
                                    <input type="radio" id="humThresholdAnd" name="humThresholdAndOr" value="and">
                                    <label for="humThresholdAnd">AND</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">Both conditions must be met to trigger the
                                        threshold.</span>
                                    <input type="radio" id="humThresholdOr" name="humThresholdAndOr" value="or">
                                    <label for="humThresholdOr">OR</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">At least one condition must be met to trigger the
                                        threshold.</span>
                                </div>
                            </fieldset>
                        </fieldset>
                    </div>

                    <div id="Bluetooth" class="tab-content">
                        <p>These are the thresholds for the Bluetooth functionality when in low power mode.</p>

                        <fieldset>
                            <legend>General Settings</legend>
                            <div>
                                <label for="keepAliveTimeBluetooth">Keep Alive Time</label>
                                <input type="number" id="keepAliveTimeBluetooth" name="keepAliveTimeBluetooth"
                                    value="0">
                                <span class="tooltip-icon">ℹ️</span>
                                <span class="tooltip-text">Maximum time in seconds to wait to send values via Bluetooth.
                                    CO2 Gadget will send values by Bluetooth regardless of the threshold if this time
                                    has passed since the last data was sent.</span>
                            </div>
                            <div>
                                <label for="thrOnlyInLowPBluetooth">Only in low power</label>
                                <span class="tooltip-text">Apply the threshold only when the device is in low power
                                    mode.</span>
                                <input type="radio" id="thrOnlyInLowPBluetooth" name="thrOnlyInLowPBluetooth"
                                    value="false">
                                <span class="tooltip-icon">ℹ️</span>
                                <span class="tooltip-text">Apply the threshold when the device is not in low power
                                    mode.</span>
                        </fieldset>


                        <fieldset>
                            <legend>Thresholds Options for Bluetooth</legend>
                            <fieldset>
                                <div>
                                    <label for="co2ThresholdAbsBluetooth">CO2 Threshold Absolute (ppm value):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The absolute value difference of CO2 in ppm that will
                                        trigger
                                        the
                                        threshold. The value will not be sent by bluetooth until the threshold is
                                        met.</span>
                                    <input type="number" id="co2ThresholdAbsBluetooth" name="co2ThresholdAbsBluetooth"
                                        value="">
                                </div>
                                <div>
                                    <label for="co2ThresholdPctBluetooth">CO2 Threshold Percentage (ppm
                                        percentage):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The percentage difference of CO2 in ppm that will trigger
                                        the
                                        threshold. The value will not be sent by bluetooth until the threshold is
                                        met.</span>
                                    <input type="number" id="co2ThresholdPctBluetooth" name="co2ThresholdPctBluetooth"
                                        value="">
                                </div>
                                <div>
                                    <label for="co2ThresholdAndOrBluetooth">Combine with:</label>
                                    <input type="radio" id="co2ThresholdAndBluetooth" name="co2ThresholdAndOrBluetooth"
                                        value="and">
                                    <label for="co2ThresholdAndBluetooth">AND</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">Both conditions must be met to trigger the
                                        threshold.</span>
                                    <input type="radio" id="co2ThresholdOrBluetooth" name="co2ThresholdAndOrBluetooth"
                                        value="or">
                                    <label for="co2ThresholdOrBluetooth">OR</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">At least one condition must be met to trigger the
                                        threshold.</span>
                                </div>
                            </fieldset>

                            <fieldset>
                                <div>
                                    <label for="tempThresholdAbsBluetooth">Temp Threshold Absolute (°C value):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The absolute value difference of temperature in °C that
                                        will
                                        trigger the threshold. The value will not be sent by bluetooth until the
                                        threshold
                                        is
                                        met.</span>
                                    <input type="number" step="any" id="tempThresholdAbsBluetooth" name="tempThresholdAbsBluetooth" value="">
                                </div>
                                <div>
                                    <label for="tempThresholdPctBluetooth">Temp Threshold Percentage (°C
                                        percentage):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The percentage difference of temperature in °C that will
                                        trigger
                                        the threshold. The value will not be sent by bluetooth until the threshold is
                                        met.</span>
                                    <input type="number" id="tempThresholdPctBluetooth" name="tempThresholdPctBluetooth"
                                        value="">
                                </div>
                                <div>
                                    <label for="tempThresholdAndOrBluetooth">Combine with:</label>
                                    <input type="radio" id="tempThresholdAndBluetooth"
                                        name="tempThresholdAndOrBluetooth" value="and">
                                    <label for="tempThresholdAndBluetooth">AND</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <input type="radio" id="tempThresholdOrBluetooth" name="tempThresholdAndOrBluetooth"
                                        value="or">
                                    <label for="tempThresholdOrBluetooth">OR</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                </div>
                            </fieldset>

                            <fieldset>
                                <div>
                                    <label for="humThresholdAbsBluetooth">Hum Threshold Absolute (%rH value):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The absolute value difference of humidity in %rH that
                                        will
                                        trigger
                                        the threshold. The value will not be sent by bluetooth until the threshold is
                                        met.</span>
                                    <input type="number" id="humThresholdAbsBluetooth" name="humThresholdAbsBluetooth"
                                        value="">
                                </div>
                                <div>
                                    <label for="humThresholdPctBluetooth">Hum Threshold Percentage (%rH
                                        percentage):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The percentage difference of humidity in %rH that will
                                        trigger
                                        the threshold. The value will not be sent by bluetooth until the threshold is
                                        met.</span>
                                    <input type="number" id="humThresholdPctBluetooth" name="humThresholdPctBluetooth"
                                        value="">
                                </div>
                                <div>
                                    <label for="humThresholdAndOrBluetooth">Combine with:</label>
                                    <input type="radio" id="humThresholdAndBluetooth" name="humThresholdAndOrBluetooth"
                                        value="and">
                                    <label for="humThresholdAndBluetooth">AND</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">Both conditions must be met to trigger the
                                        threshold.</span>
                                    <input type="radio" id="humThresholdOrBluetooth" name="humThresholdAndOrBluetooth"
                                        value="or">
                                    <label for="humThresholdOrBluetooth">OR</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">At least one condition must be met to trigger the
                                        threshold.</span>
                                </div>
                            </fieldset>
                        </fieldset>
                    </div>

                    <div id="MQTT" class="tab-content">
                        <p>These are the thresholds for the MQTT functionality when in low power mode.</p>

                        <fieldset>
                            <legend>General Settings</legend>
                            <div>
                                <label for="keepAliveTimeMQTT">Keep Alive Time</label>
                                <input type="number" id="keepAliveTimeMQTT" name="keepAliveTimeMQTT" value="0">
                                <span class="tooltip-icon">ℹ️</span>
                                <span class="tooltip-text">Maximum time in seconds to wait to send values via MQTT. CO2
                                    Gadget will send values by MQTT regardless of the threshold if this time has passed
                                    since the last data was sent.</span>
                            </div>
                            <div>
                                <label for="thrOnlyInLowPMQTT">Only in low power</label>
                                <span class="tooltip-text">Apply the threshold only when the device is in low power
                                    mode.</span>
                                <input type="radio" id="thrOnlyInLowPMQTT" name="thrOnlyInLowPMQTT" value="false">
                                <span class="tooltip-icon">ℹ️</span>
                                <span class="tooltip-text">Apply the threshold when the device is not in low power
                                    mode.</span>
                        </fieldset>

                        <fieldset>
                            <legend>Thresholds Options for MQTT</legend>
                            <fieldset>
                                <div>
                                    <label for="co2ThresholdAbsMQTT">CO2 Threshold Absolute (ppm value):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The absolute value difference of CO2 in ppm that will
                                        trigger
                                        the
                                        threshold. The value will not be sent by MQTT until the threshold is met.</span>
                                    <input type="number" id="co2ThresholdAbsMQTT" name="co2ThresholdAbsMQTT" value="">
                                </div>
                                <div>
                                    <label for="co2ThresholdPctMQTT">CO2 Threshold Percentage (ppm percentage):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The percentage difference of CO2 in ppm that will trigger
                                        the
                                        threshold. The value will not be sent by MQTT until the threshold is met.</span>
                                    <input type="number" id="co2ThresholdPctMQTT" name="co2ThresholdPctMQTT" value="">
                                </div>
                                <div>
                                    <label for="co2ThresholdAndOrMQTT">Combine with:</label>
                                    <input type="radio" id="co2ThresholdAndMQTT" name="co2ThresholdAndOrMQTT"
                                        value="and">
                                    <label for="co2ThresholdAndMQTT">AND</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">Both conditions must be met to trigger the
                                        threshold.</span>
                                    <input type="radio" id="co2ThresholdOrMQTT" name="co2ThresholdAndOrMQTT" value="or">
                                    <label for="co2ThresholdOrMQTT">OR</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">At least one condition must be met to trigger the
                                        threshold.</span>
                                </div>
                            </fieldset>

                            <fieldset>
                                <div>
                                    <label for="tempThresholdAbsMQTT">Temp Threshold Absolute (°C value):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The absolute value difference of temperature in °C that
                                        will
                                        trigger the threshold. The value will not be sent by MQTT until the threshold is
                                        met.</span>
                                    <input type="number" step="any" id="tempThresholdAbsMQTT" name="tempThresholdAbsMQTT" value="">
                                </div>
                                <div>
                                    <label for="tempThresholdPctMQTT">Temp Threshold Percentage (°C percentage):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The percentage difference of temperature in °C that will
                                        trigger
                                        the threshold. The value will not be sent by MQTT until the threshold is
                                        met.</span>
                                    <input type="number" step="any" id="tempThresholdPctMQTT" name="tempThresholdPctMQTT" value="">
                                </div>
                                <div>
                                    <label for="tempThresholdAndOrMQTT">Combine with:</label>
                                    <input type="radio" id="tempThresholdAndMQTT" name="tempThresholdAndOrMQTT"
                                        value="and">
                                    <label for="tempThresholdAndMQTT">AND</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">Both conditions must be met to trigger the
                                        threshold.</span>
                                    <input type="radio" id="tempThresholdOrMQTT" name="tempThresholdAndOrMQTT"
                                        value="or">
                                    <label for="tempThresholdOrMQTT">OR</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">At least one condition must be met to trigger the
                                        threshold.</span>
                                </div>
                            </fieldset>

                            <fieldset>
                                <div>
                                    <label for="humThresholdAbsMQTT">Hum Threshold Absolute (%rH value):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The absolute value difference of humidity in %rH that
                                        will
                                        trigger
                                        the threshold. The value will not be sent by MQTT until the threshold is
                                        met.</span>
                                    <input type="number" id="humThresholdAbsMQTT" name="humThresholdAbsMQTT" value="">
                                </div>
                                <div>
                                    <label for="humThresholdPctMQTT">Hum Threshold Percentage (%rH percentage):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The percentage difference of humidity in %rH that will
                                        trigger
                                        the threshold. The value will not be sent by MQTT until the threshold is
                                        met.</span>
                                    <input type="number" id="humThresholdPctMQTT" name="humThresholdPctMQTT" value="">
                                </div>
                                <div>
                                    <label for="humThresholdAndOrMQTT">Combine with:</label>
                                    <input type="radio" id="humThresholdAndMQTT" name="humThresholdAndOrMQTT"
                                        value="and">
                                    <label for="humThresholdAndMQTT">AND</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">Both conditions must be met to trigger the
                                        threshold.</span>
                                    <input type="radio" id="humThresholdOrMQTT" name="humThresholdAndOrMQTT" value="or">
                                    <label for="humThresholdOrMQTT">OR</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">At least one condition must be met to trigger the
                                        threshold.</span>
                                </div>
                            </fieldset>
                        </fieldset>
                    </div>


                    <div id="ESPNOW" class="tab-content">
                        <p>These are the thresholds for the ESPNOW functionality.</p>

                        <fieldset>
                            <legend>General Settings for ESPNOW</legend>
                            <div>
                                <label for="keepAliveTimeESPNOW">Keep Alive Time</label>
                                <input type="number" id="keepAliveTimeESPNOW" name="keepAliveTimeESPNOW" value="0">
                                <span class="tooltip-icon">ℹ️</span>
                                <span class="tooltip-text">Maximum time in seconds to wait to send values via ESPNOW.
                                    CO2 Gadget will send values by ESPNOW regardless of the threshold if this time has
                                    passed since the last data was sent.</span>
                            </div>
                            <div>
                                <label for="thrOnlyInLowPESPNOW">Only in low power</label>
                                <span class="tooltip-text">Apply the threshold only when the device is in low power
                                    mode.</span>
                                <input type="radio" id="thrOnlyInLowPESPNOW" name="thrOnlyInLowPESPNOW" value="false">
                                <span class="tooltip-icon">ℹ️</span>
                                <span class="tooltip-text">Apply the threshold when the device is not in low power
                                    mode.</span>
                        </fieldset>

                        <fieldset>
                            <legend>Thresholds Options for ESPNOW</legend>
                            <fieldset>
                                <div>
                                    <label for="co2ThresholdAbsESPNOW">CO2 Threshold Absolute (ppm value):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The absolute value difference of CO2 in ppm that will
                                        trigger
                                        the
                                        threshold. The value will not be sent by ESPNOW until the threshold is
                                        met.</span>
                                    <input type="number" id="co2ThresholdAbsESPNOW" name="co2ThresholdAbsESPNOW"
                                        value="">
                                </div>
                                <div>
                                    <label for="co2ThresholdPctESPNOW">CO2 Threshold Percentage (ppm
                                        percentage):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The percentage difference of CO2 in ppm that will trigger
                                        the
                                        threshold. The value will not be sent by ESPNOW until the threshold is
                                        met.</span>
                                    <input type="number" id="co2ThresholdPctESPNOW" name="co2ThresholdPctESPNOW"
                                        value="">
                                </div>
                                <div>
                                    <label for="co2ThresholdAndOrESPNOW">Combine with:</label>
                                    <input type="radio" id="co2ThresholdAndESPNOW" name="co2ThresholdAndOrESPNOW"
                                        value="and">
                                    <label for="co2ThresholdAndESPNOW">AND</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">Both conditions must be met to trigger the
                                        threshold.</span>
                                    <input type="radio" id="co2ThresholdOrESPNOW" name="co2ThresholdAndOrESPNOW"
                                        value="or">
                                    <label for="co2ThresholdOrESPNOW">OR</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">At least one condition must be met to trigger the
                                        threshold.</span>
                                </div>
                            </fieldset>

                            <fieldset>
                                <div>
                                    <label for="tempThresholdAbsESPNOW">Temp Threshold Absolute (°C value):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The absolute value difference of temperature in °C that
                                        will
                                        trigger the threshold. The value will not be sent by ESPNOW until the threshold
                                        is
                                        met.</span>
                                    <input type="number" step="any" id="tempThresholdAbsESPNOW" name="tempThresholdAbsESPNOW" value="">
                                </div>
                                <div>
                                    <label for="tempThresholdPctESPNOW">Temp Threshold Percentage (°C
                                        percentage):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The percentage difference of temperature in °C that will
                                        trigger
                                        the threshold. The value will not be sent by ESPNOW until the threshold is
                                        met.</span>
                                    <input type="number" id="tempThresholdPctESPNOW" name="tempThresholdPctESPNOW"
                                        value="">
                                </div>
                                <div>
                                    <label for="tempThresholdAndOrESPNOW">Combine with:</label>
                                    <input type="radio" id="tempThresholdAndESPNOW" name="tempThresholdAndOrESPNOW"
                                        value="and">
                                    <label for="tempThresholdAndESPNOW">AND</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">Both conditions must be met to trigger the
                                        threshold.</span>
                                    <input type="radio" id="tempThresholdOrESPNOW" name="tempThresholdAndOrESPNOW"
                                        value="or">
                                    <label for="tempThresholdOrESPNOW">OR</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">At least one condition must be met to trigger the
                                        threshold.</span>
                                </div>
                            </fieldset>

                            <fieldset>
                                <div>
                                    <label for="humThresholdAbsESPNOW">Hum Threshold Absolute (%rH value):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The absolute value difference of humidity in %rH that
                                        will
                                        trigger
                                        the threshold. The value will not be sent by ESPNOW until the threshold is
                                        met.</span>
                                    <input type="number" id="humThresholdAbsESPNOW" name="humThresholdAbsESPNOW"
                                        value="">
                                </div>
                                <div>
                                    <label for="humThresholdPctESPNOW">Hum Threshold Percentage (%rH
                                        percentage):</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">The percentage difference of humidity in %rH that will
                                        trigger
                                        the threshold. The value will not be sent by ESPNOW until the threshold is
                                        met.</span>
                                    <input type="number" id="humThresholdPctESPNOW" name="humThresholdPctESPNOW"
                                        value="">
                                </div>
                                <div>
                                    <label for="humThresholdAndOrESPNOW">Combine with:</label>
                                    <input type="radio" id="humThresholdAndESPNOW" name="humThresholdAndOrESPNOW"
                                        value="and">
                                    <label for="humThresholdAndESPNOW">AND</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">Both conditions must be met to trigger the
                                        threshold.</span>
                                    <input type="radio" id="humThresholdOrESPNOW" name="humThresholdAndOrESPNOW"
                                        value="or">
                                    <label for="humThresholdOrESPNOW">OR</label>
                                    <span class="tooltip-icon">ℹ️</span>
                                    <span class="tooltip-text">At least one condition must be met to trigger the
                                        threshold.</span>
                                </div>
                            </fieldset>
                    </div>
                </div>
            </fieldset>

            <div id="resetSaveButtons">
                <button type="button" id="resetButton" onclick="restartESP32()">Restart device</button>        
                <button type="button" id="savePreferencesButton" onclick="saveThresholdsToServer()">Save</button>
            </div>
        </form>
    </div>

    <!-- Popup to display a message -->
    <div id="popup">
        <p>Saving preferences...</p>
    </div>

    <!-- Status line to display CO2 Gadget version -->
    <div id="statusLineContainer">
        <span id="co2GadgetVersion"></span>
    </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabContent, tabLinks;
            tabContent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabContent.length; i++) {
                tabContent[i].style.display = "none";
            }
            tabLinks = document.getElementsByClassName("tab");
            for (i = 0; i < tabLinks.length; i++) {
                tabLinks[i].className = tabLinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        function toggleTab(tabName) {
            var tabContent = document.getElementById(tabName);
            var checkbox = document.getElementById("chk" + tabName);
            if (checkbox.checked) {
                tabContent.style.display = "block";
            } else {
                tabContent.style.display = "none";
            }
        }

        function toggle(checkboxId, elementId) {
            const checkbox = document.getElementById(checkboxId);
            if (!checkbox) {
                console.error('Checkbox with id ' + checkboxId + ' is not found.');
                return;                
            }
            const element = document.getElementById(elementId);
            
            if (!element) {
                console.error('Element with id ' + elementId + ' is not found.');
                return;
            }

            // Function to toggle element visibility
            function toggleElement() {
                element.style.display = checkbox.checked ? 'block' : 'none';
                // if (checkbox.checked) {
                //     element.style.display = 'block'; // Show the element if checkbox is checked
                // } else {
                //     element.style.display = 'none'; // Hide the element if checkbox is unchecked
                // }
            }

            // Call toggleElement initially to set initial state
            toggleElement();
    
            // Add event listener to checkbox to update visibility when checkbox state changes
            checkbox.addEventListener('change', toggleElement);
        }

        function loadThresholdsFromServer() {
            fetch('/getThresholdsAsJson')
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    document.getElementById("chkDisplay").checked = data[0].enabled;
                    document.getElementById("keepAliveTimeDisplay").value = data[0].thrKeepAlive;
                    document.getElementById("thrOnlyInLowPDisplay").checked = data[0].thrOnlyInLowP;
                    document.getElementById("co2ThresholdAbsDisplay").value = data[0].thrCo2Abs;
                    document.getElementById("co2ThresholdPctDisplay").value = data[0].thrCo2Per;
                    document.getElementById("tempThresholdAbsDisplay").value = data[0].thrTempAbs;
                    document.getElementById("tempThresholdPctDisplay").value = data[0].thrTempPer;
                    document.getElementById("humThresholdAbsDisplay").value = data[0].thrHumAbs;
                    document.getElementById("humThresholdPctDisplay").value = data[0].thrHumPer;
                    if (data[0].thrCo2CombAnd = true) {
                        document.getElementById("co2ThresholdAnd").checked = true;
                    } else {
                        document.getElementById("co2ThresholdOr").checked = true;
                    }
                    if (data[0].thrTempCombAnd = true) {
                        document.getElementById("tempThresholdAnd").checked = true;
                    } else {
                        document.getElementById("tempThresholdOr").checked = true;
                    }
                    if (data[0].thrHumCombAnd = true) {
                        document.getElementById("humThresholdAnd").checked = true;
                    } else {
                        document.getElementById("humThresholdOr").checked = true;
                    }

                    document.getElementById("chkBluetooth").checked = data[1].enabled;
                    document.getElementById("keepAliveTimeBluetooth").value = data[1].thrKeepAlive;
                    document.getElementById("thrOnlyInLowPBluetooth").checked = data[1].thrOnlyInLowP;
                    document.getElementById("co2ThresholdAbsBluetooth").value = data[1].thrCo2Abs;
                    document.getElementById("co2ThresholdPctBluetooth").value = data[1].thrCo2Per;
                    document.getElementById("tempThresholdAbsBluetooth").value = data[1].thrTempAbs;
                    document.getElementById("tempThresholdPctBluetooth").value = data[1].thrTempPer;
                    document.getElementById("humThresholdAbsBluetooth").value = data[1].thrHumAbs;
                    document.getElementById("humThresholdPctBluetooth").value = data[1].thrHumPer;
                    document.getElementById("co2ThresholdAndBluetooth").value = data[1].thrCo2CombAnd ? "and" : "or";
                    document.getElementById("tempThresholdAndBluetooth").value = data[1].thrTempCombAnd ? "and" : "or";
                    document.getElementById("humThresholdAndBluetooth").value = data[1].thrHumCombAnd ? "and" : "or";

                    document.getElementById("chkMQTT").checked = data[2].enabled;
                    document.getElementById("keepAliveTimeMQTT").value = data[2].thrKeepAlive;
                    document.getElementById("thrOnlyInLowPMQTT").checked = data[2].thrOnlyInLowP;
                    document.getElementById("co2ThresholdAbsMQTT").value = data[2].thrCo2Abs;
                    document.getElementById("co2ThresholdPctMQTT").value = data[2].thrCo2Per;
                    document.getElementById("tempThresholdAbsMQTT").value = data[2].thrTempAbs;
                    document.getElementById("tempThresholdPctMQTT").value = data[2].thrTempPer;
                    document.getElementById("humThresholdAbsMQTT").value = data[2].thrHumAbs;
                    document.getElementById("humThresholdPctMQTT").value = data[2].thrHumPer;
                    document.getElementById("co2ThresholdAndMQTT").value = data[2].thrCo2CombAnd ? "and" : "or";
                    document.getElementById("tempThresholdAndMQTT").value = data[2].thrTempCombAnd ? "and" : "or";
                    document.getElementById("humThresholdAndMQTT").value = data[2].thrHumCombAnd ? "and" : "or";

                    document.getElementById("chkESPNOW").checked = data[3].enabled;
                    document.getElementById("keepAliveTimeESPNOW").value = data[3].thrKeepAlive;
                    document.getElementById("thrOnlyInLowPESPNOW").checked = data[3].thrOnlyInLowP;
                    document.getElementById("co2ThresholdAbsESPNOW").value = data[3].thrCo2Abs;
                    document.getElementById("co2ThresholdPctESPNOW").value = data[3].thrCo2Per;
                    document.getElementById("tempThresholdAbsESPNOW").value = data[3].thrTempAbs;
                    document.getElementById("tempThresholdPctESPNOW").value = data[3].thrTempPer;
                    document.getElementById("humThresholdAbsESPNOW").value = data[3].thrHumAbs;
                    document.getElementById("humThresholdPctESPNOW").value = data[3].thrHumPer;
                    document.getElementById("co2ThresholdAndESPNOW").value = data[3].thrCo2CombAnd ? "and" : "or";
                    document.getElementById("tempThresholdAndESPNOW").value = data[3].thrTempCombAnd ? "and" : "or";
                    document.getElementById("humThresholdAndESPNOW").value = data[3].thrHumCombAnd ? "and" : "or";

                    // Toggle visibility of elements based on checkbox state
                    // toggle('activeWIFI', 'wifiNetworks');
                    // toggle('activeMQTT', 'mqttConfig');
                    // toggle('activeESPNOW', 'espNowConfig');
                });
        }

        function collectThresholdsData() {
            // Collect preferences data from the form
            var thresholdsData = {
                "thresholds": [
                    {
                        "enabled": document.getElementById("chkDisplay").checked,
                        "thrOnlyInLowP": document.getElementById("thrOnlyInLowPDisplay").checked,
                        "thrKeepAlive": document.getElementById("keepAliveTimeDisplay").value,
                        "thrCo2Abs": document.getElementById("co2ThresholdAbsDisplay").value,
                        "thrTempAbs": document.getElementById("tempThresholdAbsDisplay").value,
                        "thrHumAbs": document.getElementById("humThresholdAbsDisplay").value,
                        "thrCo2Per": document.getElementById("co2ThresholdPctDisplay").value,
                        "thrTempPer": document.getElementById("tempThresholdPctDisplay").value,
                        "thrHumPer": document.getElementById("humThresholdPctDisplay").value,
                        "thrCo2CombAnd": document.getElementById("co2ThresholdAnd").checked,
                        "thrTempCombAnd": document.getElementById("tempThresholdAnd").checked,
                        "thrHumCombAnd": document.getElementById("humThresholdAnd").checked
                    },
                    {
                        "enabled": document.getElementById("chkBluetooth").checked,
                        "thrOnlyInLowP": document.getElementById("thrOnlyInLowPBluetooth").checked,
                        "thrKeepAlive": document.getElementById("keepAliveTimeBluetooth").value,
                        "thrCo2Abs": document.getElementById("co2ThresholdAbsBluetooth").value,
                        "thrTempAbs": document.getElementById("tempThresholdAbsBluetooth").value,
                        "thrHumAbs": document.getElementById("humThresholdAbsBluetooth").value,
                        "thrCo2Per": document.getElementById("co2ThresholdPctBluetooth").value,
                        "thrTempPer": document.getElementById("tempThresholdPctBluetooth").value,
                        "thrHumPer": document.getElementById("humThresholdPctBluetooth").value,
                        "thrCo2CombAnd": document.getElementById("co2ThresholdAndBluetooth").checked,
                        "thrTempCombAnd": document.getElementById("tempThresholdAndBluetooth").checked,
                        "thrHumCombAnd": document.getElementById("humThresholdAndBluetooth").checked
                    },
                    {
                        "enabled": document.getElementById("chkMQTT").checked,
                        "thrOnlyInLowP": document.getElementById("thrOnlyInLowPMQTT").checked,
                        "thrKeepAlive": document.getElementById("keepAliveTimeMQTT").value,
                        "thrCo2Abs": document.getElementById("co2ThresholdAbsMQTT").value,
                        "thrTempAbs": document.getElementById("tempThresholdAbsMQTT").value,
                        "thrHumAbs": document.getElementById("humThresholdAbsMQTT").value,
                        "thrCo2Per": document.getElementById("co2ThresholdPctMQTT").value,
                        "thrTempPer": document.getElementById("tempThresholdPctMQTT").value,
                        "thrHumPer": document.getElementById("humThresholdPctMQTT").value,
                        "thrCo2CombAnd": document.getElementById("co2ThresholdAndMQTT").checked,
                        "thrTempCombAnd": document.getElementById("tempThresholdAndMQTT").checked,
                        "thrHumCombAnd": document.getElementById("humThresholdAndMQTT").checked
                    },
                    {
                        "enabled": document.getElementById("chkESPNOW").checked,
                        "thrOnlyInLowP": document.getElementById("thrOnlyInLowPESPNOW").checked,
                        "thrKeepAlive": document.getElementById("keepAliveTimeESPNOW").value,
                        "thrCo2Abs": document.getElementById("co2ThresholdAbsESPNOW").value,
                        "thrTempAbs": document.getElementById("tempThresholdAbsESPNOW").value,
                        "thrHumAbs": document.getElementById("humThresholdAbsESPNOW").value,
                        "thrCo2Per": document.getElementById("co2ThresholdPctESPNOW").value,
                        "thrTempPer": document.getElementById("tempThresholdPctESPNOW").value,
                        "thrHumPer": document.getElementById("humThresholdPctESPNOW").value,
                        "thrCo2CombAnd": document.getElementById("co2ThresholdAndESPNOW").checked,
                        "thrTempCombAnd": document.getElementById("tempThresholdAndESPNOW").checked,
                        "thrHumCombAnd": document.getElementById("humThresholdAndESPNOW").checked
                    }
                ]
            };
            return thresholdsData;
        }

        function showSavingPopup() {
            // Show the popup
            document.getElementById("popup").style.display = "block";
            console.log("Show popup");

            // After 2 seconds, hide the popup
            setTimeout(function () {
                // Oculta el popup
                document.getElementById("popup").style.display = "none";
                console.log("Hide popup");
            }, 2000);
}
        function saveThresholdsToServer() {
            // Show a popup to indicate that the preferences are being saved
            showSavingPopup();
            // Collect preferences data from the form
            var ThresholdsData = collectThresholdsData();
            console.log("Sending Thresholds to server:", ThresholdsData);

            // Send the preferences data to the server
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/saveThresholds", true);
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            xhr.send(JSON.stringify(ThresholdsData));

            // Handle the response from the server
            xhr.onload = function () {
                if (xhr.status === 200) {
                    console.log("Thresholds updated successfully!");
                } else {
                    alert("Error updating thresholds. Please try again.");
                }
            };
        }


        // Open the first tab by default
        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("Display").style.display = "block";
            var tab = document.querySelector(".tab");
            tab.className += " active";
            loadThresholdsFromServer();
        });
    </script>

</body>

</html>