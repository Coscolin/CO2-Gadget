function fetchVersion(){fetch("/getVersion").then(response=>response.json()).then(versionInfo=>{document.getElementById("co2GadgetVersion").innerText="CO2 Gadget: v"+versionInfo.firmVerMajor+"."+versionInfo.firmVerMinor+"."+versionInfo.firmRevision+"-"+versionInfo.firmBranch+" (Flavour: "+versionInfo.firmFlavour+")"}).catch(error=>console.error("Error fetching version information:",error))}function showCO2GadgetFeatures(){document.getElementById("featureBLE").textContent=features.SUPPORT_BLE;document.getElementById("featureBuzzer").textContent=features.SUPPORT_BUZZER;document.getElementById("featureESPNow").textContent=features.SUPPORT_ESPNOW;document.getElementById("featureMDNS").textContent=features.SUPPORT_MDNS;document.getElementById("featureMQTT").textContent=features.SUPPORT_MQTT;document.getElementById("featureMQTTDiscovery").textContent=features.SUPPORT_MQTT_DISCOVERY;document.getElementById("featureOTA").textContent=features.SUPPORT_OTA}function loadCaptivePortalStatusFromServer(){fetch("/getCaptivePortalStatusAsJson").then(response=>response.json()).then(data=>{console.log("Fetching data successful!");if(data.captivePortalActive!==undefined){document.getElementById("captivePortalActive").textContent=data.captivePortalActive}else{document.getElementById("captivePortalActiveItem").style.display="none"}if(data.timeCaptivePortalStarted!==undefined){document.getElementById("timeCaptivePortalStarted").textContent=data.timeCaptivePortalStarted}else{document.getElementById("timeCaptivePortalStartedItem").style.display="none"}if(data.timeToWaitForCaptivePortal!==undefined){document.getElementById("timeToWaitForCaptivePortal").textContent=data.timeToWaitForCaptivePortal}else{document.getElementById("timeToWaitForCaptivePortalItem").style.display="none"}if(data.captivePortalTimeLeft!==undefined){document.getElementById("captivePortalTimeLeft").textContent=data.captivePortalTimeLeft}else{document.getElementById("captivePortalTimeLeftItem").style.display="none"}if(data.captivePortalDebug!==undefined){document.getElementById("captivePortalDebug").textContent=data.captivePortalDebug}else{document.getElementById("captivePortalDebugItem").style.display="none"}if(data.relaxedSecurity!==undefined){document.getElementById("relaxedSecurity").textContent=data.relaxedSecurity}else{document.getElementById("relaxedSecurityItem").style.display="none"}}).catch(error=>console.error("Error fetching status:",error))}function loadStatusFromServer(){fetch("/status").then(response=>response.json()).then(data=>{console.log("Fetching data successful!");if(data.mainDeviceSelected!==undefined){document.getElementById("mainDeviceSelected").textContent=data.mainDeviceSelected}else{document.getElementById("mainDeviceSelected").style.display="none"}if(data.CO2!==undefined){document.getElementById("co2").textContent=data.CO2}else{document.getElementById("co2Item").style.display="none"}if(data.Temperature!==undefined){document.getElementById("temperature").textContent=data.Temperature}else{document.getElementById("temperatureItem").style.display="none"}if(data.Humidity!==undefined){document.getElementById("humidity").textContent=data.Humidity}else{document.getElementById("humidityItem").style.display="none"}if(data.WiFiStatus!==undefined){document.getElementById("wifiStatus").textContent=data.WiFiStatus}else{document.getElementById("wifiStatusItem").style.display="none"}if(data.SSID!==undefined){document.getElementById("ssid").textContent=data.SSID}else{document.getElementById("ssidItem").style.display="none"}if(data.WiFiPassword!==undefined){document.getElementById("wifiPass").textContent=data.WiFiPassword}else{document.getElementById("wifiPassItem").style.display="none"}if(data.IP!==undefined){document.getElementById("ip").textContent=data.IP}else{document.getElementById("ipItem").style.display="none"}if(data.RSSI!==undefined){document.getElementById("rssi").textContent=data.RSSI}else{document.getElementById("rssiItem").style.display="none"}if(data.MACAddress!==undefined){document.getElementById("macAddress").textContent=data.MACAddress}else{document.getElementById("macAddressItem").style.display="none"}if(data.hostName!==undefined){document.getElementById("hostName").textContent=data.hostName}else{document.getElementById("hostNameItem").style.display="none"}if(data.useStaticIP!==undefined){document.getElementById("useStaticIP").textContent=data.useStaticIP}else{document.getElementById("useStaticIPItem").style.display="none"}if(data.staticIP!==undefined){document.getElementById("staticIP").textContent=data.staticIP}else{document.getElementById("staticIPItem").style.display="none"}if(data.gateway!==undefined){document.getElementById("gateway").textContent=data.gateway}else{document.getElementById("gatewayItem").style.display="none"}if(data.subnet!==undefined){document.getElementById("subnet").textContent=data.subnet}else{document.getElementById("subnetItem").style.display="none"}if(data.dns1!==undefined){document.getElementById("dns1").textContent=data.dns1}else{document.getElementById("dns1Item").style.display="none"}if(data.dns2!==undefined){document.getElementById("dns2").textContent=data.dns2}else{document.getElementById("dns2Item").style.display="none"}if(data.rootTopic!==undefined){document.getElementById("rootTopic").textContent=data.rootTopic}else{document.getElementById("rootTopicItem").style.display="none"}if(data.discoveryTopic!==undefined){document.getElementById("discoveryTopic").textContent=data.discoveryTopic}else{document.getElementById("discoveryTopicItem").style.display="none"}if(data.mqttClientId!==undefined){document.getElementById("mqttClientId").textContent=data.mqttClientId}else{document.getElementById("mqttClientIdItem").style.display="none"}if(data.mqttBroker!==undefined){document.getElementById("mqttBroker").textContent=data.mqttBroker}else{document.getElementById("mqttBrokerItem").style.display="none"}if(data.mqttUser!==undefined){document.getElementById("mqttUser").textContent=data.mqttUser}else{document.getElementById("mqttUserItem").style.display="none"}if(data.mqttPassword!==undefined){document.getElementById("mqttPass").textContent=data.mqttPassword}else{document.getElementById("mqttPassItem").style.display="none"}if(data.peerESPNowAddress!==undefined){document.getElementById("peerESPNowAddress").textContent=data.peerESPNowAddress}else{document.getElementById("peerESPNowAddressItem").style.display="none"}if(data.activeWiFi!==undefined){document.getElementById("activeWiFi").textContent=data.activeWiFi}else{document.getElementById("activeWiFiItem").style.display="none"}if(data.activeMQTT!==undefined){document.getElementById("activeMQTT").textContent=data.activeMQTT}else{document.getElementById("activeMQTTItem").style.display="none"}if(data.activeBLE!==undefined){document.getElementById("activeBLE").textContent=data.activeBLE}else{document.getElementById("activeBLEItem").style.display="none"}if(data.activeOTA!==undefined){document.getElementById("activeOTA").textContent=data.activeOTA}else{document.getElementById("activeOTAItem").style.display="none"}if(data.troubledWiFi!==undefined){document.getElementById("troubledWiFi").textContent=data.troubledWiFi}else{document.getElementById("troubledWiFiItem").style.display="none"}if(data.troubledMQTT!==undefined){document.getElementById("troubledMQTT").textContent=data.troubledMQTT}else{document.getElementById("troubledMQTTItem").style.display="none"}if(data.troubledESPNow!==undefined){document.getElementById("troubledESPNow").textContent=data.troubledESPNow}else{document.getElementById("troubledESPNowItem").style.display="none"}if(data.measurementInterval!==undefined){document.getElementById("measurementInterval").textContent=data.measurementInterval}else{document.getElementById("measurementIntervalItem").style.display="none"}if(data.sampleInterval!==undefined){document.getElementById("sampleInterval").textContent=data.sampleInterval}else{document.getElementById("sampleIntervalItem").style.display="none"}if(data.calibrationValue!==undefined){document.getElementById("calibrationValue").textContent=data.calibrationValue}else{document.getElementById("calibrationValueItem").style.display="none"}if(data.pendingCalibration!==undefined){document.getElementById("pendingCalibration").textContent=data.pendingCalibration}else{document.getElementById("pendingCalibrationItem").style.display="none"}if(data.freeHeap!==undefined){document.getElementById("freeHeap").textContent=data.freeHeap}else{document.getElementById("freeHeapItem").style.display="none"}if(data.minFreeHeap!==undefined){document.getElementById("minFreeHeap").textContent=data.minFreeHeap}else{document.getElementById("minFreeHeapItem").style.display="none"}if(data.uptime!==undefined){var seconds=Math.floor(data.uptime/1e3);var minutes=Math.floor(seconds/60);var hours=Math.floor(minutes/60);var days=Math.floor(hours/24);hours=hours-days*24;minutes=minutes-days*24*60-hours*60;seconds=seconds-days*24*60*60-hours*60*60-minutes*60;document.getElementById("uptime").textContent=data.uptime}else{document.getElementById("uptimeItem").style.display="none"}}).catch(error=>console.error("Error fetching status:",error))}function getBatteryVoltage(){var xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){console.log(this.responseText);if(this.readyState==4&&this.status==200){document.getElementById("batVoltage").innerHTML=this.responseText}};xhttp.open("GET","readBatteryVoltage",true);xhttp.send()}function getFreeHeap(){var xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){console.log(this.responseText);if(this.readyState==4&&this.status==200){document.getElementById("freeHeap").innerHTML=this.responseText}};xhttp.open("GET","getFreeHeap",true);xhttp.send()}function getMinFreeHeap(){var xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){console.log(this.responseText);if(this.readyState==4&&this.status==200){document.getElementById("minFreeHeap").innerHTML=this.responseText}};xhttp.open("GET","getMinFreeHeap",true);xhttp.send()}setInterval(function(){getBatteryVoltage();getFreeHeap();getMinFreeHeap();loadCaptivePortalStatusFromServer()},1e3);window.onload=function(){getBatteryVoltage()};document.addEventListener("DOMContentLoaded",function(){var currentURL=window.location.href;if(currentURL.includes("status.html")){setTimeout(loadStatusFromServer(),100);setTimeout(fetchVersion,200);setTimeout(loadCaptivePortalStatusFromServer(),300);setTimeout(getFeaturesAsJson(),400);setTimeout(showCO2GadgetFeatures(),500)}});